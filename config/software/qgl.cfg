[quad_gantry_level]
gantry_corners:
	-46,4
	400,425
points:
	30,30
	30,320
	320,320
	320,30
speed: 300
horizontal_move_z: 1
retries: 10
retry_tolerance: 0.005
max_adjust: 15

[gcode_macro CHECK_QGL]
description: Run after QUAD_GANTRY_LEVEL to insure it passes
gcode:
  {% if not printer.quad_gantry_level.applied  %} ; check QGL and probe status
    {action_respond_info("QGL CHECK: Fail therefore cancel the print")}

    CANCEL_PRINT
  {% else %}
    {action_respond_info("QGL CHECK: Pass")}
  {% endif %}

[gcode_macro _SET_Z_CURRENT]
description: Helper: Set Z-drive motor current
variable_last_val: 'CONFIG'
gcode:
  {% set val = params.VAL|default(0.4) %}
  {% if val != last_val %}
    SET_GCODE_VARIABLE MACRO=_SET_Z_CURRENT VARIABLE=last_val VALUE='"{val}"'

    {action_respond_info("Home&Probe: RunCur %.2fA rms" % val|float)}
    SET_TMC_CURRENT STEPPER=stepper_z  CURRENT={val}
    SET_TMC_CURRENT STEPPER=stepper_z1 CURRENT={val}
    SET_TMC_CURRENT STEPPER=stepper_z2 CURRENT={val}
    SET_TMC_CURRENT STEPPER=stepper_z3 CURRENT={val}
    M400
  {% endif %}

[gcode_macro _SET_ACC]
description: Helper: Set accel and accel_to_decel value
variable_last_val: 'CONFIG'
gcode:
  {% set val = params.VAL|default('CONFIG') %}
  {% set accel = printer['gcode_macro _USER_VARIABLE'].homing.accel  if val == 'HOME'
            else printer.configfile.settings.printer.max_accel %}
  {% set accel_to_decel = printer['gcode_macro _USER_VARIABLE'].homing.accel|int / 2 if val == 'HOME'
                     else printer.configfile.settings.printer.max_accel_to_decel %}
  {% if val != last_val %}
    SET_GCODE_VARIABLE MACRO=_SET_ACC VARIABLE=last_val VALUE='"{val}"'
    {% if params.RESPOND|default(printer['gcode_macro _USER_VARIABLE'].respond.acc)|int == 1 %}
      {action_respond_info("Home&Probe: ACCEL: %d ACCEL_TO_DECEL: %d" % (accel|int, accel_to_decel|int))}
    {% endif %}
    SET_VELOCITY_LIMIT ACCEL={accel} ACCEL_TO_DECEL={accel_to_decel}
  {% endif %}